"use strict";function t(t,e,n,r){return(e=e.split?e.split("."):e.slice(0)).slice(0,-1).reduce((function(t,e){return/^(__proto__|constructor|prototype)$/.test(e)?{}:t[e]=t[e]||{}}),t)[e.pop()]=n,t}function e(t,e){return null!=t?t:e}function n(t,n,r,i){return e(e(r[n],i[n]),t)}exports.createPersistedStatePlugin=function(e){var r=e||{};return function(e){var i=function(){try{return e.options.persistedState||{}}catch(t){return{}}}();if(!1!==n(!0,"persist",i,r)){var o,s,u=n(e.store.$id,"key",i,{}),c=n(!1,"overwrite",i,r),a=n(function(){try{return window.localStorage}catch(t){return{getItem:function(){},setItem:function(){},removeItem:function(){}}}}(),"storage",i,r),f=n((function(){return!0}),"filter",i,r),d=n(JSON.stringify,"serialize",i,r),l=n(JSON.parse,"deserialize",i,r),p=n((function(t){return t}),"migrate",i,{}),m=n((function(t,e){return e}),"merge",i,{}),h=(n((function(t){var e=t.setItem("@@","1"),n=function(){t.removeItem("@@")};e instanceof Promise?e.then(n):n()}),"assertStorage",i,r),new Promise((function(t){o=t}))),v=0;e.store.$persistedState={isReady:function(){return h},pending:!1};try{(s=a.getItem(u))instanceof Promise?s.then(g):g(s)}catch(t){o()}e.store.$subscribe((function(n,r){if(!1!==f(n,r)){Array.isArray(i.includePaths)&&(r=i.includePaths.reduce((function(e,n){return t(e,n,function(t,e,n){return void 0===(t=(e.split?e.split("."):e).reduce((function(t,e){return t&&t[e]}),t))?n:t}(r,n,void 0))}),{})),Array.isArray(i.excludePaths)&&(r=l(d(r)),i.excludePaths.forEach((function(e){return t(r,e,void 0)}),{}));var o=d(r),s=a.setItem(u,o);s instanceof Promise&&(++v,e.store.$persistedState.pending=0!==v,s.catch((function(){})).finally((function(){--v,e.store.$persistedState.pending=0!==v})))}}))}function y(t){(i.beforeHydrate||function(){})(e.store.$state);var n=m(e.store.$state,t);c?e.store.$state=n:e.store.$patch(n),o()}function g(t){if(null!=t){var e=l(t),n=p(e);n instanceof Promise?n.then(y):y(n)}else o()}}};
