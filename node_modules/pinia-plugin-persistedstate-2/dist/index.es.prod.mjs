function t(t,e,n,r){return(e=e.split?e.split("."):e.slice(0)).slice(0,-1).reduce((function(t,e){return/^(__proto__|constructor|prototype)$/.test(e)?{}:t[e]=t[e]||{}}),t)[e.pop()]=n,t}function e(t,e){return null!=t?t:e}function n(t,n,r,i){return e(e(r[n],i[n]),t)}function r(e){var r=e||{};return function(e){var i=function(){try{return e.options.persistedState||{}}catch(t){return{}}}();if(!1!==n(!0,"persist",i,r)){var o,s=n(e.store.$id,"key",i,{}),c=n(!1,"overwrite",i,r),u=n(function(){try{return window.localStorage}catch(t){return{getItem:function(){},setItem:function(){},removeItem:function(){}}}}(),"storage",i,r),a=n((function(){return!0}),"filter",i,r),f=n(JSON.stringify,"serialize",i,r),l=n(JSON.parse,"deserialize",i,r),p=n((function(t){return t}),"migrate",i,{}),d=n((function(t,e){return e}),"merge",i,{}),m=n((function(t){var e=t.setItem("@@","1"),n=function(){t.removeItem("@@")};e instanceof Promise?e.then(n):n()}),"assertStorage",i,r),v=new Promise((function(t){o=t})),h=0;e.store.$persistedState={isReady:function(){return v},pending:!1};try{if("production"!==process.env.NODE_ENV){var y=m(u);y instanceof Promise?y.then((function(){return $()})).catch((function(t){return console.warn(t)})):$()}else $()}catch(t){"production"!==process.env.NODE_ENV&&console.warn(t),o()}e.store.$subscribe((function(n,r){if(!1!==a(n,r)){Array.isArray(i.includePaths)&&(r=i.includePaths.reduce((function(e,n){return t(e,n,function(t,e,n){return void 0===(t=(e.split?e.split("."):e).reduce((function(t,e){return t&&t[e]}),t))?n:t}(r,n,void 0))}),{})),Array.isArray(i.excludePaths)&&(r=l(f(r)),i.excludePaths.forEach((function(e){return t(r,e,void 0)}),{}));var o=f(r),c=u.setItem(s,o);c instanceof Promise&&(++h,e.store.$persistedState.pending=0!==h,c.catch((function(){})).finally((function(){--h,e.store.$persistedState.pending=0!==h})))}}))}function g(t){(i.beforeHydrate||function(){})(e.store.$state);var n=d(e.store.$state,t);c?e.store.$state=n:e.store.$patch(n),o()}function P(t){if(null!=t){var e=l(t),n=p(e);n instanceof Promise?n.then(g):g(n)}else o()}function $(){var t=u.getItem(s);t instanceof Promise?t.then(P):P(t)}}}export{r as createPersistedStatePlugin};
